**Симулятор молитв Genshin Impact для Twitch**

*genshin-twitch-wish не связан с HoYoverse. Genshin Impact, контент и материалы игры являются товарными знаками и принадлежат HoYoverse.*

Бот написан на Python и использует PyGame для вывода анимации, TwitchIO для взаимодействия с чатом и наградами на трансляции.

После запуска нужно добавить захват окна в OBS:
![Окно захвата](https://media.discordapp.net/attachments/706496930414592080/980878746200453120/Sxxgzt6h_Ao.jpg)

И настроить фильтр для корректной работы прозрачности окна:
![Окно фильтра](https://media.discordapp.net/attachments/706496930414592080/980878745659375726/1HahxRWaJBF1kzE3BaChFSsMspC-LWBOcPf-kcj_f9g52D-Ia53P2osjQkR4F4wZXmfmu2-Gaavy5D7rU78ilhnS.jpg)

В чате бот реагирует на команду из файла конфигурации **wish_command**. Примеры работы:
![Пример работы бота](https://media.discordapp.net/attachments/706496930414592080/980878745894260806/dCB9_I5UULE.jpg)

База предметов и персонажей актуальная для патча 2.8. Бот не использует систему баннеров, вместо этого при каждой молитве есть одинаковый шанс на выпадение любого доступного предмета или персонажа.

Описание параметров из **config.json**:  
 
 - **window_name** - название окна для захвата в **OBS**
 - **chat_bot** - секция для настройки чат-бота
   - **enabled** - включение или отключение секции (true или false)
   - **bot_token** - токен бота с правами **chat:read** и **chat:edit** 
   - **work_channel** - название канала (не ссылка, только ник), где будет работать бот 
   - **wish_command** - команда, на которую бот должен реагировать
   - **wish_command_prefix** - префикс для команды
   - **wish_global_timeout** - общее ограничение для всех пользователей на команду бота (в секундах)
   - **wish_timeout** - как часто каждый пользователь может использовать команды бота (в секундах)
     - **broadcaster** - для автора канала
     - **mod** - для модераторов
     - **subscriber** - для подписчиков
     - **user** - все остальные
   - **send_notify** - отправлять ли уведомление в чат когда пользователь снова может использовать **wish_command** 
   - **wish_count** - количество молитв, которое будет делаться за одно использование команды
   - **self_wish** - режим, при котором бот сам использует команду
   - **self_wish_every** - как часто (если включено) бот будет использовать команду
   - **enable_colors** - включить цветные ники
 - **event_bot** - секция для настройки баллов канала
   - **enabled** - включение или отключение секции (true или false)
   - **channel_token** - токен автора канала с правами **channel:read:redemptions**
   - **work_channel_id** - ID канала на котором будут использоваться награды
   - **default_color** - цвет для ников
   - **rewards** - секция настройки наград за баллы канала
     - **event_name** - название награды
     - **wish_count** - сколько молитв делать при использовании
 - **animations** - секция настройки анимаций
   - **chroma_color** - цвет хромакея
   - **start_delay** - как долго будет показан ник пользователя сделавшего молитву (в секундах)
   - **end_delay** - как долго будет показан результат молитвы (в секундах) если была сделана всего 1 молитва
     - **3** - для 3*
     - **4** - для 4*
     - **5** - для 5*
   - **end_delay_milti** - как долго будет показан результат молитвы (в секундах) если было сделано больше 1 молитвы
     - **3** - для 3*
     - **4** - для 4*
     - **5** - для 5*
   - **user_background** - секция настройки пользовательских фонов
     - **enabled** - включение или отключение секции (true или false)
     - **path** - название файла в папке background (только имя файла, не полный путь)
     - **type** - тип фона, **static** для JPG или PNG, **gif** для GIF и тд.
   - **font** - секция настройки шрифтов и текста
     - **path** - название файла в папке fonts (только имя файла, не полный путь)
     - **user_uid_size** - размер текста для отображения ника пользователя в правом нижнем углу
     - **wish_name_size** - размер текста для сплеш анимации (названия оружий и имена персонажей)
   - **fps** - частота обновления анимаций (все анимации настроены на 30 кадров в секунду)
 - **sound** - секция настройки звука (все файлы должны лежать в папке **sound**)
   - **enabled** - включение или отключение секции (true или false)
   - **fall** - для анимации падения
   - **3** - во время сплеш анимации для 3*
   - **4** - во время сплеш анимации для 4*
   - **5** - во время сплеш анимации для 5*
 - **history_file** - секция настройки записи истории молитв
   - **enabled** - включение или отключение секции (true или false)
   - **path** - имя файла (не полный путь, вместе с расширением), куда будет записываться история
   - **3** - записывать ли выпадение 3*
   - **4** - записывать ли выпадение 4*
   - **5** - записывать ли выпадение 5*
 - **wish_fo_garant** - сколько молитв должен сделать пользователь до гаранта 4*
 - **wish_fo_chance** - общий шанс выпадения 4* (от 0.01 до 99.99)
 - **wish_fi_garant** - сколько молитв должен сделать пользователь до гаранта 5*
 - **wish_fi_chance** - общий шанс выпадения 5* (от 0.01 до 99.99)
 - **wish_fi_soft_a** - после какой молитвы начнет работать мягкий гарант (должен быть меньше **wish_fi_garant**)
 - **send_dev_stats** - включение или отключение отправки анонимной статистики
 - **test_mode** - режим тестирования, твич бот не включается, автоматически делаются 100 молитв  

В сообщениях бота можно указывать параметры:
 - Общие для блоков **chatbot_text** и **chanel_points_text**
   - **username** - упоминание пользователя, который использовал команду
   - **wish_count** - сколько всего молитв сделал пользователь
   - **wish_count_w4** - сколько было сделано молитв после последней выпавшей 4*
   - **wish_count_w5** - сколько было сделано молитв после последней выпавшей 5*
   - **wishes_in_cmd** - сколько будет сделано молитв за использоание команды
   - **que_num** - номер в очереди молитв
 - Для блока **chatbot_text**
   - **user_wish_delay** - сколько пользователю придется подождать перед следующим использованием команды (параметр **wish_timeout**)
   - **global_wish_delay** - как часто весь чат может использовать команду
 - Для блока **chanel_points_text**
   - **reward_cost** - стоимость награды в баллах, которую активировал пользователь
 - Для блока **notify_text**
   - **username** - упоминание пользователя, который использовал команду
   - **command** - команда в виде **wish_command_prefix** + **wish_command**

Сервисные команды для чат бота:
 - **!gbot_status** - выводит общую информацию о боте и моливах в чат
 - **!gbot_sound** - включает или отключает звук во время молитв
 - **!gbot_pause** - включает или отключает обработку молитв. Бот по прежнему будет реагировать на использование баллов канала или команды чата, но анимации молитв воспроизводится не будут, при этом все молитвы будут находлится в очереди пока обработка не будте снова включена

Узнать свой ID канала можно тут: https://www.streamweasels.com/tools/convert-twitch-username-to-user-id/  
Управлять токенами для канала\бота можно тут: https://twitchtokengenerator.com/  
PS: настоятельно рекомендуется использовать собсвенное приложение для создания токенов: https://dev.twitch.tv/console  

*Проект собирает анонимную статистику. В нее входят время запуска и название канала из файла конфигурации. Никакие личные данные, IP адреса или токены от каналов\ботов не передаются.*